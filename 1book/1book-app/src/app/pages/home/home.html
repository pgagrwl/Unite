<div style="padding: 2rem">
  <h2>MetaMask Connect Demo</h2>
  <button (click)="connectWallet()">Connect MetaMask</button>
  <p *ngIf="address">ðŸ”— Connected: {{ address }}</p>
</div>

<div style="padding: 1rem">
  <h2>Portfolio Data</h2>

  <label>
    <input
      [(ngModel)]="manualAddress"
      placeholder="Enter address if wallet not connected"
      style="width: 100%; max-width: 400px; margin-bottom: 1rem"
    />
  </label>

  <label style="margin-left: 1rem">
    Currency:
    <select [(ngModel)]="currency">
      <option *ngFor="let c of currencies" [value]="c">{{ c }}</option>
    </select>
  </label>

  <span
    [title]="
      !address && !manualAddress ? 'Connect wallet or enter address' : ''
    "
    style="display: inline-block"
  >
    <button (click)="portfolio()">Check Portfolio</button>
  </span>

  <button (click)="exportCSV()" style="margin-left: 1rem">Export CSV</button>

  <div *ngIf="loading">Loading...</div>
</div>

<div style="padding: 1rem">
  <div>
    <label>
      Filter by Network:
      <select [(ngModel)]="filters.network">
        <option value="">All</option>
        <option *ngFor="let net of uniqueNetworks" [value]="net">
          {{ net }}
        </option>
      </select>
    </label>

    <label style="margin-left: 1rem">
      Filter by Symbol:
      <input type="text" [(ngModel)]="filters.symbol" placeholder="e.g. AAVE" />
    </label>

    <label style="margin-left: 1rem">
      Filter by Name:
      <input
        type="text"
        [(ngModel)]="filters.name"
        placeholder="e.g. Rocket Pool"
      />
    </label>
  </div>

  <input
    [(ngModel)]="portfolioFilter"
    placeholder="Quick Filter by name or symbol"
    style="margin-bottom: 1rem; width: 300px"
  />

  <table
    border="1"
    cellpadding="8"
    cellspacing="0"
    style="width: 100%; text-align: left"
  >
    <thead>
      <tr>
        <th (click)="setSort('symbol')">Symbol</th>
        <th (click)="setSort('name')">Name</th>
        <th (click)="setSort('network')">Network</th>
        <th (click)="setSort('balance')">Balance</th>
        <th (click)="setSort('value')">Value ({{ currency }})</th>
        <th>Logo</th>
        <th>Address</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of getSortedFilteredTokens()">
        <td>{{ item.symbol }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.network }}</td>
        <td>{{ item.balance }}</td>
        <td>{{ item.value }}</td>
        <td>
          <img
            [src]="item.logoURI"
            alt="{{ item.symbol }}"
            width="30"
            height="30"
          />
        </td>
        <td style="font-size: small">
          <a
            [href]="getExplorerUrl(item.chainId, item.address)"
            target="_blank"
            rel="noopener noreferrer"
          >
            {{ item.address }}
          </a>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!getSortedFilteredTokens()?.length">
    <p>No tokens matched your filter.</p>
  </div>
</div>
